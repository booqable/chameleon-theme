{%- comment -%}
  A fonts snippet that collects, filters and preloads fonts.
{%- endcomment -%}

{%- assign fonts = '' -%}
{%- assign separator = '|FONT_SEP|' -%}
{%- assign body_font = settings.body_font -%}
{%- assign heading_font = settings.heading_font -%}
{%- assign tagline_font = settings.tagline_font -%}

{%- if heading_font != blank -%}
  {%- assign heading_path = heading_font.path -%}

  {%- unless fonts contains heading_path -%}
    {%- if fonts == '' -%}
      {%- assign fonts = heading_path -%}
    {%- else -%}
      {%- assign fonts = fonts | append: separator | append: heading_path -%}
    {%- endif -%}
  {%- endunless -%}
{%- endif -%}

{%- if body_font != blank -%}
  {%- assign body_path = body_font.path -%}

  {%- unless fonts contains body_path -%}
    {%- if fonts == '' -%}
      {%- assign fonts = body_path -%}
    {%- else -%}
      {%- assign fonts = fonts | append: separator | append: body_path -%}
    {%- endif -%}
  {%- endunless -%}
{%- endif -%}

{%- if tagline_font != blank -%}
  {%- assign tagline_path = tagline_font.path -%}

  {%- unless fonts contains tagline_path -%}
    {%- if fonts == '' -%}
      {%- assign fonts = tagline_path -%}
    {%- else -%}
      {%- assign fonts = fonts | append: separator | append: tagline_path -%}
    {%- endif -%}
  {%- endunless -%}
{%- endif -%}

{%- if fonts != '' -%}
  {%- assign paths = fonts | split: separator -%}

  {%- comment -%}
    Preload font files for faster loading
  {%- endcomment -%}
  {%- for path in paths -%}
    <link rel="preload" as="font" href="{{ path }}" type="font/woff2" crossorigin>
  {%- endfor -%}

  {%- comment -%}
    Generate @font-face declarations with font-display: swap for better performance
  {%- endcomment -%}
  <style>
    {%- if heading_font != blank -%}
      {%- if paths contains heading_path -%}
        {{- heading_font | font_face: font_display: 'swap' -}}
      {%- endif -%}
    {%- endif -%}

    {%- if body_font != blank and body_font != heading_font -%}
      {%- if paths contains body_font -%}
        {{- body_font | font_face: font_display: 'swap' -}}
      {%- endif -%}
    {%- endif -%}

    {%- if tagline_font != blank and tagline_font != heading_font and tagline_font != body_font -%}
      {%- if paths contains tagline_font -%}
        {{- tagline_font | font_face: font_display: 'swap' -}}
      {%- endif -%}
    {%- endif -%}
  </style>

  {%- comment -%}
    Fallback for browsers without JavaScript
  {%- endcomment -%}
  <noscript>
    {%- if heading_font != blank -%}
      {%- if paths contains heading_path -%}
        {{- heading_font | font_link -}}
      {%- endif -%}
    {%- endif -%}

    {%- if body_font != blank -%}
      {%- if paths contains body_path and body_path != heading_path -%}
        {{- body_font | font_link -}}
      {%- endif -%}
    {%- endif -%}

    {%- if tagline_font != blank -%}
      {%- if paths contains tagline_path and tagline_path != heading_path and tagline_path != body_path -%}
        {{- tagline_font | font_link -}}
      {%- endif -%}
    {%- endif -%}
  </noscript>
{%- endif -%}

<link rel="preload" href="https://kit.fontawesome.com/ff3b3de2b5.js" as="script" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/ff3b3de2b5.js" crossorigin="anonymous" defer></script>
