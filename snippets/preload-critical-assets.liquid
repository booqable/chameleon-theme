{% comment %}
  Preload critical assets for performance optimization

  This snippet analyzes the currently rendered template and preloads critical assets
  like hero images that appear above the fold.
{% endcomment %}

{% if template == 'index' %}
  {% for section in sections %}
    {% if forloop.first and section.type == 'images' %}
      {% for block in section.blocks %}
        {% if forloop.first and block.settings.image != blank %}
          {% comment %} Preload the first image in the first images section {% endcomment %}
          <link rel="preload"
                as="image"
                href="{{ block.settings.image | image_url: width: 1200 }}"
                imagesizes="100vw"
                fetchpriority="high">
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endfor %}
{% elsif template == 'product' %}
  {% if product.featured_image != blank %}
    <link rel="preload"
          as="image"
          href="{{ product.featured_image | image_url: width: 1200 }}"
          imagesizes="100vw"
          fetchpriority="high">
  {% endif %}
{% elsif template == 'collection' %}
  {% if collection.image != blank %}
    <link rel="preload"
          as="image"
          href="{{ collection.image | image_url: width: 1200 }}"
          imagesizes="100vw"
          fetchpriority="high">
  {% endif %}
{% endif %}
