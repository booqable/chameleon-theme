{%- if section.blocks.size > 0 -%}

  {{ "collections.css" | asset_url | stylesheet_tag }}

  {%- assign tag                   = section.settings.tag -%}
  {%- assign title                 = section.settings.title -%}
  {%- assign title_bg              = section.settings.title_bg -%}
  {%- assign description           = section.settings.description -%}
  {%- assign view_all              = section.settings.view_all -%}
  {%- assign padding_top           = section.settings.padding_top -%}
  {%- assign padding_bottom        = section.settings.padding_bottom -%}
  {%- assign padding_top_mobile    = section.settings.padding_top_mobile -%}
  {%- assign padding_bottom_mobile = section.settings.padding_bottom_mobile -%}
  {%- assign image_placeholder     = settings.image_placeholder -%}

  {% comment %} CSS variables start {% endcomment %}
  {%- capture variables -%}
    {%- if padding_top != blank -%}
      --padding-top: {{ padding_top }}px;
    {%- endif -%}
    {%- if padding_bottom != blank -%}
      --padding-bottom: {{ padding_bottom }}px;
    {%- endif -%}
    {%- if padding_top_mobile != blank -%}
      --padding-top-mobile: {{ padding_top_mobile }}px;
    {%- endif -%}
    {%- if padding_bottom_mobile != blank -%}
      --padding-bottom-mobile: {{ padding_bottom_mobile }}px;
    {%- endif -%}
  {%- endcapture -%}
  {% comment %} CSS variables end {% endcomment %}

  <div
    class="collections__wrapper{% if padding_top != blank or padding_top_mobile != blank %} collections__wrapper--padding-top{% endif %}{% if padding_bottom != blank or padding_bottom_mobile != blank %} collections__wrapper--padding-bottom{%- endif -%}"
    style="{{- variables | escape -}}"
  >
    <div class="collections__container container">
      <div class="collections__top">
        <div class="collections__col">
          {%- if tag != blank -%}
            <span class="collections__tag">{{- tag -}}</span>
          {%- endif -%}

          {%- if title != blank -%}
            <h2 class="collections__title">{{- title -}}</h2>
          {%- endif -%}

          {%- if description != blank -%}
            <div class="collections__description">{{- description -}}</div>
          {%- endif -%}
        </div>

        <div class="collections__col">
          {%- if title_bg != blank -%}
            <h2 class="collections__title_bg">{{- title_bg -}}</h2>
          {%- endif -%}

          {%- if view_all != blank -%}
            <a href="{{ routes.collections_url }}" class="collections__show button button--outlined button--large">
              {{- view_all -}}
            </a>
          {%- endif -%}
        </div>
      </div>

      <div class="collections__list">
        {%- for block in section.blocks -%}
          {%- assign collection = block.settings.collection -%}

          {%- if collection != blank -%}
            {%- assign first_product = collection.products | first -%}

            {%- if collection.image -%}
              {%- assign image = collection.image -%}
            {%- elsif first_product and first_product.images.first != empty -%}
              {%- assign image = first_product.images.first -%}
            {%- endif -%}

            <li class="collections__item">
              <a class="collections__link" href="{{ collection.url }}">
                <span class="collections__image-item">
                  {{- image.url | image_tag:
                    loading: 'lazy',
                    class: 'collections__image',
                    widths: '450, 550, 650',
                    sizes: '(max-width: 576px) 450px, (max-width: 768px) 550px, 650px',
                    alt: collection.name
                  -}}
                </span>
              </a>

              <h3 class="collections__heading">
                <a href="{{ collection.url }}">
                  {{- collection.name -}}
                </a>
              </h3>
            </li>
          {%- else -%}
            {%- assign image = image_placeholder -%}

            <li class="collections__item">
              <span class="collections__image-item">
                {{- image.url | image_tag:
                  loading: 'lazy',
                  class: 'collections__image',
                  widths: '450, 550, 650',
                  sizes: '(max-width: 576px) 450px, (max-width: 768px) 550px, 650px',
                  alt: 'Placeholder image'
                -}}
              </span>
            </li>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
  {
    "name": "Collections",
    "description": "Display a list of collections.",
    "tag": "section",
    "class": "collections",
    "settings": [
      {
        "type": "header",
        "content": "General settings"
      },
      {
        "type": "text",
        "id": "tag",
        "label": "Tag",
        "default": "Our collections"
      },
      {
        "type": "text",
        "id": "title",
        "label": "Title",
        "default": "We can service you in each category"
      },
      {
        "type": "text",
        "id": "title_bg",
        "label": "Title on the background",
        "default": "Category"
      },
      {
        "type": "contentEditor",
        "id": "description",
        "label": "Description",
        "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit."
      },
      {
        "type": "text",
        "id": "view_all",
        "label": "Label of button",
        "info": "Note: This button redirects the user to the collections page. If the label is empty - the button absent"
      },
      {
        "type": "header",
        "content": "Desktop settings"
      },
      {
        "type": "number",
        "id": "padding_top",
        "label": "Padding top",
        "min": 0,
        "max": 100,
        "default": 80,
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "number",
        "id": "padding_bottom",
        "label": "Padding bottom",
        "min": 0,
        "max": 100,
        "default": 96,
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "header",
        "content": "Mobile settings"
      },
      {
        "type": "number",
        "id": "padding_top_mobile",
        "label": "Padding top",
        "min": 0,
        "max": 100,
        "default": 40,
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "number",
        "id": "padding_bottom_mobile",
        "label": "Padding bottom",
        "min": 0,
        "max": 100,
        "default": 40,
        "info": "Note: Use positive numbers only"
      }
    ],
    "max_blocks": 4,
    "blocks": [
      {
        "type": "collection",
        "name": "Collection",
        "settings": [
          {
            "type": "collection",
            "id": "collection",
            "label": "Collection"
          }
        ]
      }
    ]
  }
{% endschema %}
