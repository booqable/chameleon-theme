{{ "offices.css" | asset_url | stylesheet_tag }}
{{ "tabs.css" | asset_url | stylesheet_tag }}

{%- assign tag                   = section.settings.tag -%}
{%- assign title                 = section.settings.title -%}
{%- assign title_bg              = section.settings.title_bg -%}
{%- assign description           = section.settings.description -%}
{%- assign opener                = section.settings.opener -%}
{%- assign placement             = section.settings.placement -%}
{%- assign padding_top           = section.settings.padding_top -%}
{%- assign padding_bottom        = section.settings.padding_bottom -%}
{%- assign padding_top_mobile    = section.settings.padding_top_mobile -%}
{%- assign padding_bottom_mobile = section.settings.padding_bottom_mobile -%}
{%- assign image_placeholder     = settings.image_placeholder -%}

{% comment %} CSS variables start {% endcomment %}
{%- capture variables -%}
  {%- if padding_top != blank -%}
    --padding-top: {{ padding_top }}px;
  {%- endif -%}
  {%- if padding_bottom != blank -%}
    --padding-bottom: {{ padding_bottom }}px;
  {%- endif -%}
  {%- if padding_top_mobile != blank -%}
    --padding-top-mobile: {{ padding_top_mobile }}px;
  {%- endif -%}
  {%- if padding_bottom_mobile != blank -%}
    --padding-bottom-mobile: {{ padding_bottom_mobile }}px;
  {%- endif -%}
  --max-width: 1344px;

  {%- case placement -%}
    {%- when 'left' -%}
      --direction: rtl;
    {%- when 'right' -%}
      --direction: ltr;
  {%- endcase -%}
{%- endcapture -%}
{% comment %} CSS variables end {% endcomment %}

{%- capture tabs -%}
  <ul class="tabs__tab">
    {%- for block in section.blocks -%}
      {%- assign first   = forloop.first -%}
      {%- assign index   = forloop.index -%}
      {%- assign heading = block.settings.heading -%}
      {%- assign address = block.settings.address -%}
      {%- assign label   = block.settings.label -%}
      {%- assign url     = block.settings.url -%}

      <li data-trigger="tab-{{- index -}}" class="tabs__trigger{% if first %} active{%- endif -%}">
        {%- if heading != blank -%}
          <span class="tabs__heading">{{- heading -}}</span>
        {%- endif -%}

        {%- if address != blank -%}
          <address class="tabs__address">{{- address -}}</address>
        {%- endif -%}

        {%- if label != blank and url != blank -%}
          <a href="{{  url }}" class="tabs__link button button--secondary" target="_blank">
            {{- label -}}
          </a>
        {%- endif -%}
      </li>
    {%- endfor -%}
  </ul>
{%- endcapture -%}

{%- capture tabs_content -%}
  <div class=“tabs__contents”>
    {%- for block in section.blocks -%}
      {%- assign first = forloop.first -%}
      {%- assign index = forloop.index -%}
      {%- assign image = block.settings.image -%}

      {%- if image != blank -%}
        {%- assign image = block.settings.image -%}
      {%- elsif image_placeholder != blank -%}
        {%- assign image = image_placeholder -%}
      {%- else -%}
        {%- assign image = blank -%}
      {%- endif -%}

      <div data-content="tab-{{- index -}}" class="tabs__content{% if first %} active{%- endif -%}">
        <div class="tabs__image-wrapper{% if image == blank %} no-image{%- endif -%}">
          {%- if image != blank -%}
            {{- image.url | image_tag:
              loading: 'lazy',
              class: 'tabs__image',
              widths: '450, 550, 650',
              sizes: '(max-width: 576px) 450px, (max-width: 768px) 550px, 650px',
              alt: image.name
            -}}
          {%- endif -%}
        </div>
      </div>
    {%- endfor -%}
  </div>
{%- endcapture -%}

<div
  class="offices__wrapper{% if padding_top != blank or padding_top_mobile != blank %} offices__wrapper--padding-top{% endif %}{% if padding_bottom != blank or padding_bottom_mobile != blank %} offices__wrapper--padding-bottom{%- endif -%}"
  style="{{- variables | escape -}}"
>
  <div class="offices__container container">
    {%- if tag != blank or title != blank or description != blank or title_bg != blank -%}
      {%- render 'section-header',
          tag: tag,
          title: title,
          description: description,
          background: title_bg
      -%}
    {%- endif -%}

    <div class="offices__tabs tabs">
      <div class="tabs--mobile">
        <div class="tabs__select">
          <input type="checkbox" id="tabs-select-opener" style="display: none">
          <label for="tabs-select-opener" class="tabs__select-opener">
            {{- opener -}}
            {%- render 'icon-arrow-right' -%}
          </label>

          <div class="tabs__select-drop">
            {{- tabs -}}
          </div>
        </div>

      </div>

      <div class="tabs--desktop">
        {{- tabs -}}
      </div>

      {{- tabs_content -}}
    </div>
  </div>
</div>

<script src="{{ "tabs.js" | asset_url }}" defer></script>

{% schema %}
  {
    "name": "Offices",
    "tag": "section",
    "class": "offices",
    "description": "Display the addresses of offices with coordinates on a map",
    "blocks":[
      {
        "type": "tab",
        "name": "Tab",
        "settings": [
          {
            "type": "header",
            "content": "Tab settings"
          },
          {
            "type": "text",
            "id": "heading",
            "label": "Heading",
            "default": "Sydney"
          },
          {
            "type": "contentEditor",
            "id": "address",
            "label": "Address",
            "default": "123 Sample St, Sydney NSW 2000 AU"
          },
          {
            "type": "text",
            "id": "label",
            "label": "Link label",
            "default": "View Map"
          },
          {
            "type": "url",
            "id": "url",
            "label": "Link url"
          },
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          }
        ]
      }
    ],
    "settings": [
      {
        "type": "header",
        "content": "Translations"
      },
      {
        "type": "text",
        "id": "opener",
        "label": "Mobile opener",
        "default": "Open to a view list of offices"
      },
      {
        "type": "header",
        "content": "General settings"
      },
      {
        "type": "text",
        "id": "tag",
        "label": "Tag",
        "default": "Our offices"
      },
      {
        "type": "text",
        "id": "title",
        "label": "Title",
        "default": "Visit our stores"
      },
      {
        "type": "text",
        "id": "title_bg",
        "label": "Title on the background"
      },
      {
        "type": "contentEditor",
        "id": "description",
        "label": "Description",
        "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit."
      },
      {
        "type": "header",
        "content": "Desktop settings"
      },
      {
        "type": "select",
        "id": "placement",
        "label": "Map placement",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ],
        "default": "right"
      },
      {
        "type": "number",
        "id": "padding_top",
        "label": "Padding top",
        "min": 0,
        "max": 150,
        "default": 112,
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "number",
        "id": "padding_bottom",
        "label": "Padding bottom",
        "min": 0,
        "max": 150,
        "default": 112,
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "header",
        "content": "Mobile settings"
      },
      {
        "type": "number",
        "id": "padding_top_mobile",
        "label": "Padding top",
        "min": 0,
        "max": 100,
        "default": 70,
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "number",
        "id": "padding_bottom_mobile",
        "label": "Padding bottom",
        "min": 0,
        "max": 100,
        "default": 70,
        "info": "Note: Use positive numbers only"
      }
    ]
  }
{% endschema %}
