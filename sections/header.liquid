<link rel="preload" href="{{ 'header.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{{ 'mega-menu.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{{ 'buttons.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">

{%- assign search_placeholder       = section.settings.search_placeholder -%}
{%- assign hide_top_bar             = section.settings.hide_top_bar -%}
{%- assign top_bar_image            = section.settings.top_bar_image -%}
{%- assign top_bar_text             = section.settings.top_bar_text -%}
{%- assign top_bar_phone            = section.settings.top_bar_phone -%}
{%- assign top_bar_message          = section.settings.top_bar_message -%}
{%- assign top_bar_menu             = section.settings.top_bar_menu -%}
{%- assign top_bar_background 		= section.settings.top_bar_background -%}
{%- assign top_bar_foreground 		= section.settings.top_bar_foreground -%}
{%- assign logo                     = section.settings.logo -%}
{%- assign custom_title 			= section.settings.custom_title -%}
{%- assign menu 					= section.settings.menu -%}
{%- assign menu_position 			= section.settings.menu_position -%}
{%- assign menu_position_mobile 	= section.settings.menu_position_mobile -%}
{%- assign header_background 		= section.settings.header_background -%}
{%- assign header_foreground 		= section.settings.header_foreground -%}
{%- assign padding_top 				= section.settings.padding_top -%}
{%- assign padding_bottom 			= section.settings.padding_bottom -%}
{%- assign padding_top_mobile 		= section.settings.padding_top_mobile -%}
{%- assign padding_bottom_mobile 	= section.settings.padding_bottom_mobile -%}
{%- assign sticky_header 			= section.settings.sticky_header -%}

{%- capture variables -%}
    --color-top-bar-background: {{ top_bar_background }};
    --color-top-bar-foreground: {{ top_bar_foreground }};
    --color-header-background: {{ header_background }};
    --color-header-foreground: {{ header_foreground }};
    --padding-top: {{ padding_top }}px;
    --padding-bottom: {{ padding_bottom }}px;
    --padding-top-mobile: {{ padding_top_mobile }}px;
    --padding-bottom-mobile: {{ padding_bottom_mobile }}px;

    {%- case menu_position -%}
        {%- when 'left' -%}
            --justify-content: flex-start;
		{%- when 'left-center' -%}
			--justify-content: center;
		{%- when 'left-right' -%}
			--justify-content: flex-end;
        {%- when 'left-below' -%}
            --justify-content: flex-start;
        {%- when 'center-left' -%}
            --justify-content: flex-start;
	{%- endcase -%}

	{%- case menu_position_mobile -%}
        {%- when 'left' -%}
            --translate: translateX(-100%);
		{%- when 'right' -%}
			--translate: translateX(100%);
	{%- endcase -%}
{%- endcapture -%}

{%- if hide_top_bar != true -%}
    {%- capture anoncement_bar -%}
        <div class="header__anoncement-bar anoncement-bar">
			<div class="anoncement-bar__container container">
				<div class="anoncement-bar__info">
					{%- if top_bar_image != blank -%}
						<img
							src="{{ top_bar_image | image_url }}"
							alt="{{- top_bar_image.alt -}}"
							class="anoncement-bar__icon"
						>
					{%- endif -%}

					{%- if top_bar_text != blank -%}
						<span class="anoncement-bar__text">
							{{- top_bar_text -}}
						</span>
					{%- endif -%}

					{%- if top_bar_phone != blank -%}
						<span class="anoncement-bar__phone">
							<a href="tel:{{ top_bar_phone | remove: '+' | remove: ' ' }}" class="anoncement-bar__phone-link">
								{{- top_bar_phone -}}
							</a>
						</span>
					{%- endif -%}
				</div>

				<span class="anoncement-bar__text">
					{%- if top_bar_message != blank -%}
						{{- top_bar_message -}}
					{%- endif -%}
				</span>

				<nav class="anoncement-bar__menu">
					{%- if top_bar_menu != blank -%}
						<ul class="anoncement-bar__menu-list">
							{%- for link in top_bar_menu.items -%}
								{%- if link != blank -%}
									<li class="anoncement-bar__menu-item">
										<a href="{{ link.url }}" class="anoncement-bar__menu-link">
											{{- link.title -}}
										</a>
									</li>
								{%- endif -%}
							{%- endfor -%}
						</ul>
					{%- endif -%}
				</nav>
			</div>
        </div>
    {%- endcapture -%}
{%- endif -%}

{%- capture header_login -%}
	<div class="header__login">
		<button class="button">Log in</button>
		<button class="button button--primary button--small">Sign up</button>
	</div>
{%- endcapture -%}

{%- if menu != blank -%}
	{%- capture header_menu -%}
		<div class="header__nav-wrapper">
			<input type="checkbox" id="mobile-menu-trigger" style="display: none;">
			<label for="mobile-menu-trigger" class="menu__opener">
				<span></span>
			</label>

			<nav class="header__nav menu" style="display: none;">
				<ul class="header__nav-list menu__list">
					{%- for link in menu.items -%}
						{%- assign link_index = forloop.index -%}

						{%- if link != blank -%}
							<li class="menu__item">
								<a href="{{ link.url }}" class="menu__link">
									{{- link.title -}}
								</a>

								{%- if link.items_count > 0 -%}
									<input type="checkbox" id="dropdown-menu-trigger-{{- link_index -}}" style="display: none;">
									<label for="dropdown-menu-trigger-{{- link_index -}}" class="menu__dropdown-opener">
										<i class="fa-regular fa-chevron-down menu__item-icon"></i>
									</label>
								{%- endif -%}

								{%- if link.items_count > 0 -%}
									<div class="menu__dropdown" style="display: none;">
										<label for="dropdown-menu-trigger-{{- link_index -}}" class="menu__dropdown-opener">
											<i class="fa-regular fa-chevron-down menu__item-icon"></i>
											Back
										</label>

										<ul class="menu__dropdown-list">
											{%- for childlink in link.items -%}
												{%- assign childlink_index = forloop.index -%}

												{%- if childlink != blank -%}
													<li class="menu__dropdown-item">
														<a href="{{ childlink.url }}" class="menu__dropdown-link">
															{{- childlink.title -}}
														</a>

														{%- if childlink.items_count > 0 -%}
															<input type="checkbox" id="dropdown-childmenu-trigger-{{- childlink_index -}}" style="display: none;">
															<label for="dropdown-childmenu-trigger-{{- childlink_index -}}" class="menu__dropdown-opener">
																<i class="fa-regular fa-chevron-down menu__item-icon"></i>
															</label>
														{%- endif -%}

														{%- if childlink.items_count > 0 -%}
															<div class="menu__dropdown">
																<label for="dropdown-childmenu-trigger-{{- childlink_index -}}" class="menu__dropdown-opener">
																	<i class="fa-regular fa-chevron-down menu__item-icon"></i>
																	Back
																</label>

																<ul class="menu__dropdown-list">
																	{%- for grandchildlink in childlink.items -%}
																		{%- if grandchildlink != blank -%}
																			<li class="menu__dropdown-item">
																				<a href="{{ grandchildlink.url }}" class="menu__dropdown-link">
																					{{- grandchildlink.title -}}
																				</a>
																			</li>
																		{%- endif -%}
																	{%- endfor -%}
																</ul>
															</div>
														{%- endif -%}
													</li>
												{%- endif -%}
											{%- endfor -%}
										</ul>
									</div>
								{%- endif -%}
							</li>
						{%- endif -%}
					{%- endfor -%}
				</ul>

				{{- header_login -}}
			</nav>
		</div>
	{%- endcapture -%}
{%- endif -%}

{%- capture header_logo -%}
	<div class="header__logo-wrapper">
		<a href="{{ routes.root_url }}" class="header__logo">
			{%- if logo != blank -%}
				<img
					src="{{ logo | image_url }}"
					alt="{{ shop.name }}"
					class="header__logo-image"
				>
			{%- elsif custom_title != blank -%}
				<h1 class="header__logo-text">
					{{- custom_title -}}
				</h1>
			{%- elsif shop.logo_url != blank -%}
				<img
					src="{{ shop.logo_url }}"
					alt="{{ shop.name }}"
					class="header__logo-image"
				>
			{%- else -%}
				<h1 class="header__logo-text">
					{{- shop.name -}}
				</h1>
			{%- endif -%}
		</a>
	</div>
{%- endcapture -%}

{%- capture header_search -%}
	<div class="header__search">
		<input type="checkbox" id="floating-search" style="display: none">
		<label for="floating-search" class="header__search-trigger">
			<i class="fa-light fa-magnifying-glass header__search-icon open"></i>
		</label>

		<div class="header__search-wrapper" style="display: none">
			<form id="search" action="{{ routes.search_url }}" role="search">
				<div class="header__search-input-wrapper">
					<i class="fa-light fa-magnifying-glass header__search-icon"></i>
					<input type="search" name="q" class="header__search-input" placeholder="{{- search_placeholder -}}">
				</div>
				<label class="header__search-trigger" for="floating-search">
					<i class="fa-light fa-xmark header__search-icon close"></i>
				</label>
			</form>
		</div>
	</div>
{%- endcapture -%}

{%- capture header_links -%}
	<div class="header__links">
		{{- header_search -}}

		{{- header_login -}}

		<div class="header__cart">
			{{- cart_button -}}

			<i class="fa-regular fa-spinner-third fa-spin"></i>
		</div>
	</div>
{%- endcapture -%}

<div class="header__wrapper{% if menu_position == 'center-left' %} header-logo-centered{%- endif -%}{% if menu_position == 'left-below' %} header-menu-bottom{%- endif -%}" style="{{- variables | escape -}}">

	{{- anoncement_bar -}}

	<div class="header__content{% if padding_top != 0 or padding_top_mobile != 0 %} header__content--padding-top{% endif %}{% if padding_bottom != 0 or padding_bottom_mobile != 0 %} header__content--padding-bottom{%- endif -%}">
		<div class="header__container container">
			<div class="header__content-inner">

				{{- header_logo -}}

				{{- header_menu -}}

				{{- header_links -}}

			</div>
		</div>
	</div>
</div>

<script>
  	{%- if sticky_header -%}
		document.querySelector('.header').classList.add('header-sticky')
	{%- endif -%}
</script>

{% schema %}
    {
        "name": "Header",
        "tag": "header",
        "class": "header",
        "templates": [],
        "settings": [
            {
                "type": "header",
                "content": "Translations"
            },
            {
                "type": "text",
                "id": "search_placeholder",
                "label": "Search placeholder",
                "default": "Search"
            },
            {
                "type": "header",
                "content": "Announcement bar"
            },
            {
                "type": "checkbox",
                "id": "hide_top_bar",
                "default": false,
                "label": "Hide bar"
            },
            {
                "type": "image_picker",
                "id": "top_bar_image",
                "label": "Image"
            },
            {
                "type": "text",
                "id": "top_bar_text",
                "label": "Text",
                "default": "Call Us 24/7"
            },
            {
                "type": "text",
                "id": "top_bar_phone",
                "label": "Phone number",
                "default": "+1 755 302 8549",
                "info": "This field accepts only numbers, sign '+' and spaces"
            },
            {
                "type": "contentEditor",
                "id": "top_bar_message",
                "label": "Message",
                "default": "Free shipping from €50"
            },
            {
                "type": "menu",
                "id": "top_bar_menu",
                "label": "Anoncement menu",
                "info": "Use menus with one or couple of links max"
            },
            {
                "type": "color",
                "id": "top_bar_background",
                "label": "Background color",
				"default": "#F4B841"
            },
            {
                "type": "color",
                "id": "top_bar_foreground",
                "label": "Foreground color",
				"default": "#0B1A26"
            },
            {
                "type": "header",
                "content": "Header"
            },
			{
                "type": "checkbox",
                "id": "sticky_header",
                "default": true,
                "label": "Sticky header"
            },
            {
                "type": "image_picker",
                "id": "logo",
                "label": "Logo"
            },
            {
                "type": "text",
                "id": "custom_title",
                "label": "Custom title",
                "description": "Note: Header logo always overrides this title"
            },
			{
                "type": "color",
                "id": "header_background",
                "label": "Background color",
                "default": "#0E1B2A"
            },
            {
                "type": "color",
                "id": "header_foreground",
                "label": "Foreground color",
                "default": "#FFFFFF"
            },
            {
                "type": "menu",
                "id": "menu",
                "label": "Mega menu"
            },
			{
                "type": "header",
                "content": "Desktop settings"
            },
            {
                "type": "select",
                "id": "menu_position",
                "label": "Menu position",
                "options": [
                    {
                        "value": "left",
                        "label": "Logo left / Menu left"
                    },
                    {
                        "value": "left-center",
                        "label": "Logo left / Menu center"
                    },
                    {
                        "value": "left-right",
                        "label": "Logo left / Menu right"
                    },
                    {
                        "value": "left-below",
                        "label": "Logo left / Menu below"
                    },
                    {
                        "value": "center-left",
                        "label": "Logo center / Menu left"
                    }
                ],
                "default": "left-center"
            },
            {
                "type": "number",
                "id": "padding_top",
                "label": "Padding top",
				"default": "16",
                "info": "Use positive numbers only"
            },
            {
                "type": "number",
                "id": "padding_bottom",
                "label": "Padding bottom",
				"default": "16",
                "info": "Use positive numbers only"
            },
            {
                "type": "header",
                "content": "Mobile settings"
            },
			{
                "type": "select",
                "id": "menu_position_mobile",
                "label": "Menu appearance",
                "options": [
                    {
                        "value": "left",
                        "label": "From left"
                    },
                    {
                        "value": "right",
                        "label": "From right"
                    }
                ],
                "default": "left"
            },
            {
                "type": "number",
                "id": "padding_top_mobile",
                "label": "Padding top",
				"default": "16",
                "info": "Use positive numbers only"
            },
            {
                "type": "number",
                "id": "padding_bottom_mobile",
                "label": "Padding bottom",
				"default": "16",
                "info": "Use positive numbers only"
            }
        ]
    }
{% endschema %}
