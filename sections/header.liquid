<link rel="preload" href="{{ 'header.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{{ 'mega-menu.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="{{ 'buttons.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">

{%- assign search_placeholder    = section.settings.search_placeholder -%}
{%- assign logo                  = section.settings.logo -%}
{%- assign custom_title          = section.settings.custom_title -%}
{%- assign menu                  = section.settings.menu -%}
{%- assign menu_position         = section.settings.menu_position -%}
{%- assign menu_position_mobile  = section.settings.menu_position_mobile -%}
{%- assign header_background     = section.settings.header_background -%}
{%- assign header_foreground     = section.settings.header_foreground -%}
{%- assign padding_top           = section.settings.padding_top -%}
{%- assign padding_bottom        = section.settings.padding_bottom -%}
{%- assign padding_top_mobile    = section.settings.padding_top_mobile -%}
{%- assign padding_bottom_mobile = section.settings.padding_bottom_mobile -%}
{%- assign sticky_header         = section.settings.sticky_header -%}

{%- capture variables -%}
  --color-header-background: {{ header_background }};
  --color-header-foreground: {{ header_foreground }};
  --padding-top: {{ padding_top }}px;
  --padding-bottom: {{ padding_bottom }}px;
  --padding-top-mobile: {{ padding_top_mobile }}px;
  --padding-bottom-mobile: {{ padding_bottom_mobile }}px;

  {%- case menu_position -%}
    {%- when 'left' -%}
      --justify-content: flex-start;
    {%- when 'left-center' -%}
      --justify-content: center;
    {%- when 'left-right' -%}
      --justify-content: flex-end;
    {%- when 'left-below' -%}
      --justify-content: flex-start;
    {%- when 'center-left' -%}
      --justify-content: flex-start;
  {%- endcase -%}

	{%- case menu_position_mobile -%}
    {%- when 'left' -%}
      --translate: translateX(-100%);
    {%- when 'top' -%}
      --translate: translate(0, -100%);
		{%- when 'right' -%}
			--translate: translateX(100%);
	{%- endcase -%}
{%- endcapture -%}

{%- capture header_login -%}
  <div class="header__login">
    <button class="button">Log in</button>
    <button class="button button--primary button--small">Sign up</button>
  </div>
{%- endcapture -%}

{% comment %} Menu component {% endcomment %}
{%- if menu != blank -%}
  {%- capture header_menu -%}
    <div class="header__nav-wrapper header__nav-wrapper--{{- menu_position_mobile -}}">
      <input type="checkbox" id="mobile-menu-trigger" style="display: none;">
      <label for="mobile-menu-trigger" class="menu__opener">
        <span></span>
      </label>

      <nav class="header__nav menu" style="display: none;">
        <ul class="header__nav-list menu__list">
          {%- for link in menu.items -%}
            {%- assign link_index = forloop.index -%}

            {%- if link != blank -%}
              <li class="menu__item">
                <a href="{{ link.url }}" class="menu__link">
                  {{- link.title -}}
                </a>

                {%- if link.items_count > 0 -%}
                  <input type="checkbox" id="dropdown-menu-trigger-{{- link_index -}}" style="display: none;">
                  <label for="dropdown-menu-trigger-{{- link_index -}}" class="menu__dropdown-opener">
                    <i class="fa-regular fa-chevron-down menu__item-icon"></i>
                  </label>
                {%- endif -%}

                {%- if link.items_count > 0 -%}
                  <div class="menu__dropdown" style="display: none;">
                    <label for="dropdown-menu-trigger-{{- link_index -}}" class="menu__dropdown-opener">
                      <i class="fa-regular fa-chevron-down menu__item-icon"></i>
                      Back
                    </label>

                    <ul class="menu__dropdown-list">
                      {%- for childlink in link.items -%}
                        {%- assign childlink_index = forloop.index -%}

                        {%- if childlink != blank -%}
                          <li class="menu__dropdown-item">
                            <a href="{{ childlink.url }}" class="menu__dropdown-link">
                              {{- childlink.title -}}
                            </a>

                            {%- if childlink.items_count > 0 -%}
                              <input type="checkbox" id="dropdown-childmenu-trigger-{{- childlink_index -}}" style="display: none;">
                              <label for="dropdown-childmenu-trigger-{{- childlink_index -}}" class="menu__dropdown-opener">
                                <i class="fa-regular fa-chevron-down menu__item-icon"></i>
                              </label>
                            {%- endif -%}

                            {%- if childlink.items_count > 0 -%}
                              <div class="menu__dropdown">
                                <label for="dropdown-childmenu-trigger-{{- childlink_index -}}" class="menu__dropdown-opener">
                                  <i class="fa-regular fa-chevron-down menu__item-icon"></i>
                                  Back
                                </label>

                                <ul class="menu__dropdown-list">
                                  {%- for grandchildlink in childlink.items -%}
                                    {%- if grandchildlink != blank -%}
                                      <li class="menu__dropdown-item">
                                        <a href="{{ grandchildlink.url }}" class="menu__dropdown-link">
                                          {{- grandchildlink.title -}}
                                        </a>
                                      </li>
                                    {%- endif -%}
                                  {%- endfor -%}
                                </ul>
                              </div>
                            {%- endif -%}
                          </li>
                        {%- endif -%}
                      {%- endfor -%}
                    </ul>
                  </div>
                {%- endif -%}
              </li>
            {%- endif -%}
          {%- endfor -%}
        </ul>

        {{- header_login -}}
      </nav>
    </div>
  {%- endcapture -%}
{%- endif -%}

{% comment %} Logo component {% endcomment %}
{%- capture header_logo -%}
  {%- if logo.url != blank -%}
    <div class="header__logo-wrapper">
      <a href="{{ routes.root_url }}" class="header__logo">
        <img
          src="{{ logo | image_url: 'master' }}"
          alt="{{ shop.name }}"
          class="header__logo-image"
        >
      </a>
    </div>
  {%- elsif custom_title != blank -%}
    <div class="header__logo-wrapper">
      <a href="{{ routes.root_url }}" class="header__logo">
        <h2 class="header__logo-text">
          {{- custom_title -}}
        </h2>
      </a>
    </div>
  {%- elsif shop.logo_url != blank -%}
    <div class="header__logo-wrapper">
      <a href="{{ routes.root_url }}" class="header__logo">
        <img
          src="{{ shop.logo_url }}"
          alt="{{ shop.name }}"
          class="header__logo-image"
        >
      </a>
    </div>
  {%- else -%}
    <div class="header__logo-wrapper">
      <a href="{{ routes.root_url }}" class="header__logo">
        <h2 class="header__logo-text">
          {{- shop.name -}}
        </h2>
      </a>
    </div>
  {%- endif -%}
{%- endcapture -%}

{% comment %} Search component {% endcomment %}
{%- capture header_search -%}
  <div class="header__search">
    <input type="checkbox" id="floating-search" style="display: none">
    <label for="floating-search" class="header__search-trigger">
      <i class="fa-light fa-magnifying-glass header__search-icon open"></i>
    </label>

    <div class="header__search-wrapper" style="display: none">
      <form id="search" action="{{ routes.search_url }}" role="search">
        <div class="header__search-input-wrapper">
          <i class="fa-light fa-magnifying-glass header__search-icon"></i>
          <input type="search" name="q" class="header__search-input" placeholder="{{- search_placeholder -}}">
        </div>
        <label class="header__search-trigger" for="floating-search">
          <i class="fa-light fa-xmark header__search-icon close"></i>
        </label>
      </form>
    </div>
  </div>
{%- endcapture -%}

{% comment %} Right side links component {% endcomment %}
{%- capture header_links -%}
  <div class="header__links">
    {{- header_search -}}

    {{- header_login -}}

    <div class="header__cart">
      {{- cart_button -}}

      <i class="fa-regular fa-spinner-third fa-spin"></i>
    </div>
  </div>
{%- endcapture -%}

<div class="header__wrapper{% if menu_position == 'center-left' %} header-logo-centered{%- endif -%}{% if menu_position == 'left-below' %} header-menu-bottom{%- endif -%}" style="{{- variables | escape -}}">
  <div class="header__content{% if padding_top != 0 or padding_top_mobile != 0 %} header__content--padding-top{% endif %}{% if padding_bottom != 0 or padding_bottom_mobile != 0 %} header__content--padding-bottom{%- endif -%}">
    <div class="header__container container">
      <div class="header__content-inner">

        {{- header_logo -}}

        {{- header_menu -}}

        {{- header_links -}}

      </div>
    </div>
  </div>
</div>

{%- if sticky_header -%}
  <script>
    const header = document.querySelector('.header');
    const topBar = document.querySelector('.anoncement-bar');

    if (topBar) {
      topBar.classList.add('anoncement-bar--sticky')
    }

    header.classList.add('header--sticky')
  </script>
{%- endif -%}

{% schema %}
  {
    "name": "Header",
    "tag": "header",
    "class": "header",
    "templates": [],
    "settings": [
      {
        "type": "header",
        "content": "Translations"
      },
      {
        "type": "text",
        "id": "search_placeholder",
        "label": "Search placeholder",
        "default": "Search"
      },
      {
        "type": "header",
        "content": "General settings"
      },
      {
        "type": "checkbox",
        "id": "sticky_header",
        "default": true,
        "label": "Sticky header"
      },
      {
        "type": "image_picker",
        "id": "logo",
        "label": "Logo"
      },
      {
        "type": "text",
        "id": "custom_title",
        "label": "Custom title",
        "description": "Note: Header logo always overrides this title"
      },
      {
        "type": "color",
        "id": "header_background",
        "label": "Background color",
        "default": "#0E1B2A"
      },
      {
        "type": "color",
        "id": "header_foreground",
        "label": "Foreground color",
        "default": "#FFFFFF"
      },
      {
        "type": "menu",
        "id": "menu",
        "label": "Mega menu"
      },
      {
        "type": "header",
        "content": "Desktop settings"
      },
      {
        "type": "select",
        "id": "menu_position",
        "label": "Menu position",
        "options": [
          {
            "value": "left",
            "label": "Logo left / Menu left"
          },
          {
            "value": "left-center",
            "label": "Logo left / Menu center"
          },
          {
            "value": "left-right",
            "label": "Logo left / Menu right"
          },
          {
            "value": "left-below",
            "label": "Logo left / Menu below"
          },
          {
            "value": "center-left",
            "label": "Logo center / Menu left"
          }
        ],
        "default": "left-center"
      },
      {
        "type": "number",
        "id": "padding_top",
        "label": "Padding top",
        "default": "16",
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "number",
        "id": "padding_bottom",
        "label": "Padding bottom",
        "default": "16",
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "header",
        "content": "Mobile settings"
      },
      {
        "type": "select",
        "id": "menu_position_mobile",
        "label": "Menu appearance",
        "options": [
          {
            "value": "top",
            "label": "From top"
          },
          {
            "value": "left",
            "label": "From left"
          },
          {
            "value": "right",
            "label": "From right"
          }
        ],
        "default": "top"
      },
      {
        "type": "number",
        "id": "padding_top_mobile",
        "label": "Padding top",
        "default": "16",
        "info": "Note: Use positive numbers only"
      },
      {
        "type": "number",
        "id": "padding_bottom_mobile",
        "label": "Padding bottom",
        "default": "16",
        "info": "Note: Use positive numbers only"
      }
    ]
  }
{% endschema %}
