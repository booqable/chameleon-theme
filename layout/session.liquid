<!DOCTYPE html>
<html lang="{{ locale }}" class="{{- settings.element_design -}}-design">
  <head>
    {% comment %} Base metadata {% endcomment %}
    {%- render 'page-base-meta',
        brand_color: branding_color,
        canonical_url: canonical_url,
        page_description: page_description,
        page_title: page_title,
        settings: settings,
        is_local_env: local_env?,
        shop: shop
    -%}

    {% comment %} Resource hints for performance {% endcomment %}
    {%- render 'page-resource-hints' -%}

    {% comment %} Preload fonts {% endcomment %}
    {%- render 'fonts', settings: settings -%}

    {% comment %} Load root styles {% endcomment %}
    {%- render 'root-styles', settings: settings -%}

    {% comment %} Load critical above-the-fold styles {% endcomment %}
    {%- render 'critical-css' -%}

    {% comment %} Async CSS loading with resource hints {% endcomment %}
    {%- assign css_files = "base.css, rx.css, header.css, mega-menu.css, top-bar.css" | split: ", " -%}

    {%- for css_file in css_files -%}
      {%- assign css_url = css_file | asset_url -%}
      <link rel="preload" href="{{ css_url }}" as="style">
      <link rel="stylesheet" href="{{ css_url }}" media="print" onload="this.media='all'">
    {%- endfor -%}

    <noscript>
      {%- for css_file in css_files -%}
        <link rel="stylesheet" href="{{ css_file | asset_url }}">
      {%- endfor -%}
    </noscript>

    {{ content_for_header }}

    {%- render 'page-social-share-meta',
        canonical_url: canonical_url,
        locale: locale,
        image_url: page_meta_image_url,
        image_alt: page_meta_image_alt,
        page_description: page_description,
        page_title: page_title,
        product: product,
        shop: shop
    -%}
  </head>
  <body>
    <header class="header" id="header">
      {% section 'top-bar' %}
      {% section 'header' %}
    </header>

    <main id="main">
      {{ content_for_layout }}
    </main>

    {% section 'footer' %}

    {%- render 'cookie-notice-variables', settings: settings -%}

    {%- if show_mini_cart -%}
      {%- render 'variables-mini-cart', settings: settings, color_palette: "one" -%}
    {%- endif -%}

    {% comment %} Critical JavaScript files {% endcomment %}
    <script src='{{ 'js-utils-core.js' | asset_url }}' defer></script>
    <script src='{{ 'js-utils-minimal.js' | asset_url }}' defer></script>
    <script src='{{ 'js-utils.js' | asset_url }}' defer></script>
    <script src='{{ 'js-header-components-manager.js' | asset_url }}' defer></script>
    <script src='{{ 'js-top-bar.js' | asset_url }}' defer></script>
    <script src='{{ 'js-header.js' | asset_url }}' defer></script>

    {% comment %} Non-Critical JavaScript files {% endcomment %}
    {%- assign scripts = 'js-image-loading.js, js-header-menu.js, js-cookie-notice-styles-loading.js, js-touch-device-notch.js' -%}
    {%- render 'scripts-loading', scripts: scripts -%}

    {{ content_for_body }}

  </body>
</html>
