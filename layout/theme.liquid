<!DOCTYPE html>
<html lang="{{ locale }}" class="{{- settings.element_design -}}-design">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="{%- if settings.accent_background != blank -%}{{- settings.accent_background -}}{%- else -%}{{- branding_color -}}{%- endif -%}">

    {% comment %} Resource hints for performance {% endcomment %}
    <link rel="preconnect" href="https://cdn2.booqable.com" crossorigin>
    <link rel="preconnect" href="https://cdn3.booqable.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn2.booqable.com">
    <link rel="dns-prefetch" href="https://cdn3.booqable.com">

    {% comment %} Preload critical fonts {% endcomment %}
    <link rel="preload" href="https://kit.fontawesome.com/ff3b3de2b5.js" as="script" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/ff3b3de2b5.js" crossorigin="anonymous" async></script>

    {% comment %} Critical CSS {% endcomment %}
    {% render 'critical-css' %}

    {% comment %} Async CSS loading {% endcomment %}
    {% assign base_url = 'base.css' | asset_url %}
    {% assign rx_url = 'rx.css' | asset_url %}

    <link rel="preload" href="{{ base_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="{{ rx_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">

    <noscript>
      <link rel="stylesheet" href="{{ base_url }}">
      <link rel="stylesheet" href="{{ rx_url }}">
    </noscript>

    {% render 'fonts', settings: settings %}
    {% render 'root-styles', settings: settings %}

    {{ content_for_header }}

    {% render 'page-metadata',
      canonical_url: canonical_url,
      page_title: page_title,
      page_description: page_description,
      page_meta_image_url: page_meta_image_url,
      page_meta_image_alt: page_meta_image_alt,
      product: product,
      shop: shop,
      locale: locale
    %}

    {% comment %} Performance monitoring {% endcomment %}
    <script>
      window.performance.mark('start');
      // Core Web Vitals RUM data collection
      window.addEventListener('DOMContentLoaded', () => {
        window.performance.mark('DOMContentLoaded');
      })
      window.addEventListener('load', () => {
        window.performance.mark('loaded');
      })
    </script>
  </head>
  <body>
    <header class="header" id="header">
      {% section 'top-bar' %}
      {% section 'header' %}
    </header>

    <main id="main">
      {{ content_for_layout }}
    </main>

    {% section 'footer' %}

    {% comment %} scripts loading {% endcomment %}
    <script>
      // list of critical scripts that supposed to be loaded first
      const criticalScripts = [
        "{{ 'js-images.js' | asset_url }}",
        "{{ 'js-header.js' | asset_url }}",
        "{{ 'js-main.js' | asset_url }}"
      ]

      // non-critical scripts
      const nonCriticalScripts = [
        "{{ 'lazysizes.min.js' | asset_url }}",
        "{{ 'js-carousel.js' | asset_url }}",
        "{{ 'js-text-with-image.js' | asset_url }}",
        "{{ 'js-touch-device-notch.js' | asset_url }}",
        "{{ 'js-sidebar.js' | asset_url }}"
      ]

      // create scripts function
      const createScript = (src) => {
        const script = document.createElement('script');
        script.src = src;
        script.defer = true;
        document.body.appendChild(script);
      }

      criticalScripts.forEach(createScript)

      window.addEventListener('load', () => nonCriticalScripts.forEach(createScript))
    </script>

    {%- if show_mini_cart -%}
      {%- render 'variables-mini-cart', settings: settings, color_palette: "one" -%}
    {%- endif -%}

    {{ content_for_body }}
  </body>
</html>
